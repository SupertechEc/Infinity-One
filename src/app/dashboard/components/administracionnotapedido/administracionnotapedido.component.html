<main>
    <div class="componentes">
        <form [formGroup]="f" (ngSubmit)="save()">
            <div class="seccion-uno">
                <div class="form__div">
                    <div class="campo">
                        <mat-form-field appearance="outline">
                            <mat-label>Abastecedora:</mat-label>
                            <mat-select formControlName="abastecedoraId" required>
                                <mat-option>Opciones</mat-option>
                                <mat-option *ngFor="let abas of abastecedora" [value]="abas.codigo"
                                    (click)="filterAbas(abas)">
                                    {{abas.codigo}} - {{abas.nombre}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div *ngIf="abastecedoraIdNotValid" class="text-danger notification">
                        Campo no seleccionado.
                    </div>
                </div>
                <div class="form__div">
                    <div class="campo">
                        <mat-form-field appearance="outline">
                            <mat-label>Comercializadora:</mat-label>
                            <mat-select formControlName="comercializadoraId" required>
                                <mat-option>Opciones</mat-option>
                                <mat-option *ngFor="let comer of comercializadora" [value]="comer.codigo"
                                    (click)="filterCome(comer)">
                                    {{comer.codigo}} - {{comer.nombre}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div *ngIf="comercializadoraIdNotValid" class="text-danger notification">
                        Campo no seleccionado.
                    </div>
                </div>
                <div class="form__div">
                    <div class="campo">
                        <mat-form-field appearance="outline">
                            <mat-label>Terminal:</mat-label>
                            <mat-select formControlName="terminalId" required>
                                <mat-option>Opciones</mat-option>
                                <mat-option *ngFor="let ter of terminal" [value]="ter.codigo" (click)="filterTerm(ter)">
                                    {{ter.codigo}} - {{ter.nombre}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div *ngIf="terminalIdNotValid" class="text-danger notification">
                        Campo no seleccionado.
                    </div>
                </div>
            </div>
            <div class="contenedor-opciones">
                <div class="opciones-fecha">
                    <div class="subtitle">Elija el tipo de fecha.</div>
                    <div class="opciones">
                        <mat-radio-group>
                            <mat-radio-button value="fechaVenta" (click)="changeFilter(1)">
                                Fecha de Venta.
                            </mat-radio-button>
                            <mat-radio-button value="fechaDespacho" (click)="changeFilter(2)">
                                Fecha de Despacho.
                            </mat-radio-button>
                        </mat-radio-group>
                    </div>
                </div>
                <div class="fecha">
                    <mat-form-field appearance="outline">
                        <mat-label>Fecha:</mat-label>
                        <input matInput [matDatepicker]="picker" formControlName="fecha"
                            (dateChange)="getFecha($event)">
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                </div>
            </div>
            <div class="contenedor-checkbox">
                <mat-checkbox class="example-margin" (change)="porProcesar($event)" formControlName="porProcesar">Ver
                    sólo por procesar:
                </mat-checkbox>
            </div>
            <div class="mat-elevation-z8">
                <table mat-table [dataSource]="dataSource" formArrayName="datosNotaPedido">
                    <!-- Row definitions -->
                    <tr mat-header-row *matHeaderRowDef="displayColumns"></tr>
                    <tr mat-row *matRowDef="let row; let i = index; columns: displayColumns;"></tr>

                    <!-- Column definitions -->
                    <!-- <ng-container matColumnDef="id">
                        <th mat-header-cell *matHeaderCellDef> Index </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            {{index}}
                        </td>
                    </ng-container> -->

                    <ng-container matColumnDef="cliente">
                        <th mat-header-cell *matHeaderCellDef> Cliente </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <fieldset [disabled]=true class="cliente">
                                <input type="text" formControlName="cliente">
                            </fieldset>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="factura">
                        <th mat-header-cell *matHeaderCellDef> Factura </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <fieldset [disabled]=true>
                                <input type="text" formControlName="factura" class="factura">
                            </fieldset>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="numero">
                        <th mat-header-cell *matHeaderCellDef> Número NP</th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <fieldset [disabled]=true class="numero">
                                <input type="number" formControlName="numero">
                            </fieldset>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="producto">
                        <th mat-header-cell *matHeaderCellDef> Producto </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <fieldset [disabled]=true class="producto">
                                <input type="text" formControlName="productoCodigo">
                            </fieldset>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="volSolicitado">
                        <th mat-header-cell *matHeaderCellDef> Vol. Solicitado </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <fieldset [disabled]=true class="volSolicitado">
                                <input type="number" formControlName="volSolicitado">
                            </fieldset>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="volAutorizado">
                        <th mat-header-cell *matHeaderCellDef> Vol. Autorizado </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <a class="btn">
                                <fieldset class="volAutorizado">
                                    <input type="number" formControlName="volAutorizado">
                                </fieldset>
                            </a>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="fechaVenta">
                        <th mat-header-cell *matHeaderCellDef> Fecha Venta </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <input type="date" formControlName="fechaVenta" type="hidden" #fechaVenta>
                            <label>{{fechaVenta.value}}</label>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="fechaDespacho">
                        <th mat-header-cell *matHeaderCellDef> Fecha Despacho </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <input type="text" formControlName="fechaDespacho" type="hidden" #fechaDespacho>
                            <label>{{fechaDespacho.value}}</label>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="adelantar">
                        <th mat-header-cell *matHeaderCellDef> Adelantar </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <fieldset class="check">
                                <mat-checkbox formControlName="adelantar"></mat-checkbox>
                            </fieldset>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="autorizar">
                        <th mat-header-cell *matHeaderCellDef> Autorizar </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <fieldset class="check">
                                <mat-checkbox formControlName="autorizar" (change)="autorizar($event, row)">
                                </mat-checkbox>
                            </fieldset>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="anular">
                        <th mat-header-cell *matHeaderCellDef> Anular </th>
                        <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="getActualIndex(index)">
                            <fieldset class="check">
                                <mat-checkbox formControlName="anular" (change)="anular($event, row)"></mat-checkbox>
                            </fieldset>
                        </td>
                    </ng-container>
                </table>
                <mat-paginator [pageSizeOptions]="[5, 10, 15]" showFirstLastButtons></mat-paginator>
            </div>

            <div class="btn-opciones">
                <button mat-raised-button (click)="back()" type="button">Cancelar</button>
                <button mat-raised-button class="btn-next" [disabled]="f.invalid" type="submit">Procesar</button>
                <button mat-raised-button [disabled]="f.invalid" (click)="anularBtn()" type="button">Anular</button>
                <button mat-raised-button [disabled]="f.invalid" (click)="filterSave()"
                    type="button">Actualizar</button>
            </div>
        </form>

        <!-- <pre>{{ f.value | json }}</pre> -->
    </div>
</main>